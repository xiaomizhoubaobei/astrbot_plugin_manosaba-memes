# 审判表情包历史记录 - 开发文档

## 功能概述

记录用户生成的审判表情包历史，支持查看和重新发送。

---

## 需求分析

### 用户场景

- **查看历史**：用户想查看之前生成的表情包
- **重新发送**：快速重新发送之前的表情包
- **参考灵感**：查看历史记录获取灵感

### 功能需求

1. 记录用户生成的审判表情包
2. 查看历史记录列表
3. 重新发送历史记录中的表情包
4. 限制历史记录数量

---

## 实现步骤

### 步骤1：添加数据模型

在数据模型文件中添加历史记录项数据类，包含ID、时间戳、选项列表、角色等字段。

### 步骤2：实现历史记录管理

在插件类中添加历史记录管理方法：

1. 添加历史记录到列表开头
2. 限制历史记录数量（建议最多20条）
3. 保存历史记录数据到文件
4. 从文件加载历史记录数据
5. 获取历史记录列表
6. 删除历史记录项

### 步骤3：修改审判表情包命令

在审判表情包命令处理器中，生成图片成功后自动保存到历史记录。

### 步骤4：实现命令处理器

创建命令处理器方法：

1. 审判历史命令：显示历史记录列表，包含时间、角色、选项数量等信息
2. 重发命令：根据序号重新生成历史记录中的表情包

---

## 测试方案

| 测试用例    | 输入            | 预期结果     |
|---------|---------------|----------|
| 生成后查看历史 | 【赞同】测试 → 审判历史 | 显示历史记录   |
| 重发历史    | 重发 1          | 重新生成图片   |
| 序号无效    | 重发 999        | 提示序号无效   |
| 历史达上限   | 生成20个后查看      | 只显示最近20条 |

---

## 注意事项

- 历史记录应按时间倒序排列，最新的在前
- 历史记录数量应有限制，防止占用过多存储空间
- 历史记录应包含完整的生成参数，支持重新生成
- 时间显示应使用人类可读格式
- 序号应从1开始显示，便于用户操作

---

## 扩展思路

1. 支持删除历史记录
2. 支持清空历史记录
3. 支持历史记录搜索功能
4. 支持历史记录分类功能
5. 支持历史记录导出功能

---

## 许可证

本项目遵循 AGPL-3.0 许可证条款。