# 审判投票功能 - 开发文档

## 功能概述

生成审判选项后，让群成员投票选择，增加群互动性。

---

## 需求分析

### 用户场景

- **群互动**：群成员对某个话题进行投票
- **意见调查**：收集群成员的意见
- **娱乐游戏**：作为群聊游戏使用

### 功能需求

1. 生成审判选项后启动投票
2. 支持成员投票选择选项
3. 实时显示投票结果
4. 投票结束后显示最终结果

---

## 实现步骤

### 步骤1：添加数据模型

在数据模型文件中添加投票会话数据类，包含会话ID、选项列表、投票记录、投票者、开始时间、持续时间、状态等字段。

### 步骤2：实现投票管理

在插件类中添加投票管理方法：

1. 创建投票会话
2. 保存会话数据
3. 添加投票记录
4. 验证投票有效性（一人一票）
5. 计算投票结果
6. 结束投票会话

### 步骤3：修改审判表情包命令

在审判表情包命令处理器中，添加参数支持，可选择是否启动投票。

### 步骤4：实现命令处理器

创建命令处理器方法：

1. 开始投票命令：对最后生成的审判表情包进行投票，支持设置投票时长
2. 投票命令：进行投票选择，记录投票信息
3. 投票结果命令：显示当前投票结果

### 步骤5：实现定时结束

使用定时任务，在投票时长结束后自动结束投票并公布结果。

---

## 测试方案

| 测试用例 | 输入            | 预期结果      |
|------|---------------|-----------|
| 开始投票 | 【赞同】测试 → 开始投票 | 投票会话创建    |
| 进行投票 | 投票 1          | 投票成功      |
| 重复投票 | 投票 1          | 提示已投票     |
| 查看结果 | 投票结果          | 显示投票结果    |
| 投票超时 | 等待时长结束        | 自动结束并公布结果 |

---

## 注意事项

- 每个用户只能投一票，重复投票应提示
- 投票时长建议10-300秒，太长失去意义，太短来不及投票
- 投票结果应实时更新
- 投票选项与审判表情包选项一一对应
- 投票结束后应清除会话数据，释放资源

---

## 扩展思路

1. 支持匿名投票
2. 支持多选投票
3. 支持投票权重
4. 支持投票结果导出
5. 支持投票历史记录
6. 支持投票模板功能

---

## 许可证

本项目遵循 AGPL-3.0 许可证条款。