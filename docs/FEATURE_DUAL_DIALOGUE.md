# 双人对话模式 - 开发文档

## 功能概述

生成艾玛和希罗之间的对话图片，用于角色互动创作。

---

## 需求分析

### 用户场景

- **角色互动创作**：创作艾玛和希罗的对话内容
- **故事创作**：制作角色故事片段
- **社交对话模拟**：模拟两人对话场景

### 功能需求

1. 支持指定两个角色的对话内容
2. 支持多轮对话
3. 自动排列对话顺序
4. 限制对话轮数

---

## 实现步骤

### 步骤1：添加数据模型

在数据模型文件中添加对话行数据类，包含角色和文本字段，并实现验证逻辑确保对话内容不为空。

### 步骤2：实现命令处理器

创建命令处理器方法，实现以下逻辑：

1. 解析消息内容，提取对话项
2. 验证每项对话的格式（必须包含冒号分隔角色和文本）
3. 验证角色有效性
4. 验证对话内容不为空
5. 构建对话行列表
6. 验证对话轮数（至少两轮）
7. 生成对话图片
8. 返回图片结果

---

## 测试方案

| 测试用例 | 输入                | 预期结果   |
|------|-------------------|--------|
| 正常对话 | 双人对话 艾玛:你好 希罗:你好呀 | 生成图片   |
| 格式错误 | 双人对话 艾玛你好 希罗你好呀   | 提示格式错误 |
| 对话过少 | 双人对话 艾玛:你好        | 提示至少两轮 |

---

## 注意事项

- 对话行数应限制在合理范围内（建议最多3-5轮）
- 支持中英文冒号作为分隔符
- 对话内容应自动去除首尾空格
- 临时文件应正确清理

---

## 扩展思路

1. 支持更多角色（如新增角色）
2. 支持自定义对话背景
3. 支持对话气泡样式自定义
4. 支持导出对话文本

---

## 许可证

本项目遵循 AGPL-3.0 许可证条款。